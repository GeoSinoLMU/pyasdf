
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyasdf &mdash; pyasdf 0.1.x documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.2.0/sandstone/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/my-styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="pyasdf 0.1.x documentation" href="#" />
    <link rel="next" title="Installation" href="installation.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

<style>
    #forkongithub a{background:#659872;color:#FFFFFF;text-decoration:none;font-family:arial,sans-serif;text-align:center;font-weight:bold;padding:5px
    40px;font-size:1rem;line-height:2rem;position:relative;transition:0.5s;}
    #forkongithub a:hover{background:#FFFFFF;color:#659872;}
    #forkongithub a::after{bottom:1px;top:auto;}
    @media screen and (min-width:768px){
        #forkongithub {position:fixed;display:block;top:0;right:0;width:200px;overflow:hidden;height:200px;z-index:9999;}
        #forkongithub a{width:200px;position:absolute;top:30px;right:-60px;transform:rotate(45deg);-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);-moz-transform:rotate(45deg);-o-transform:rotate(45deg);box-shadow:4px 4px 10px rgba(0,0,0,0.8);}}

    .navbar-right {
        display: none
    }
</style>

<span id="forkongithub">
    <a href="https://github.com/SeismicData/pyasdf">Fork me on GitHub</a>
</span>


  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">
          pyasdf</a>
        <span class="navbar-text navbar-version pull-left"><b>0.1.x</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="http://obspy.org">ObsPy</a></li>
                <li><a href="http://github.com/SeismicData/pyasdf">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="asdf_data_set.html">ASDF Data Set</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="pyasdf">
<h1>pyasdf<a class="headerlink" href="#pyasdf" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal"><span class="pre">pyasdf</span></code> is a Python API to read and write seismological ASDF files.</p>
<div class="admonition-contact-us admonition">
<p class="first admonition-title">Contact Us</p>
<p class="last">If you encounter a bug or another error, please open a new
<a class="reference external" href="https://github.com/SeismicData/pyasdf/issues">issue</a> on Github.</p>
</div>
<p>This document is organized as follows. Other documents can be reached via
the navigation bar up top.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#installation" id="id1">Installation</a></li>
<li><a class="reference internal" href="#tutorial" id="id2">Tutorial</a><ul>
<li><a class="reference internal" href="#learning-python-and-obspy" id="id3">Learning Python and ObsPy</a></li>
<li><a class="reference internal" href="#using-pyasdf" id="id4">Using pyasdf</a><ul>
<li><a class="reference internal" href="#creating-an-asdf-data-set" id="id5">Creating an ASDF data set</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#acknowledgements" id="id6">Acknowledgements</a></li>
<li><a class="reference internal" href="#detailed-documentation" id="id7">Detailed Documentation</a></li>
</ul>
</div>
<div class="section" id="installation">
<h2><a class="toc-backref" href="#id1">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>To get started, please follow the <a class="reference internal" href="installation.html"><em>Installation</em></a> instructions.</p>
</div>
<div class="section" id="tutorial">
<h2><a class="toc-backref" href="#id2">Tutorial</a><a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h2>
<div class="section" id="learning-python-and-obspy">
<h3><a class="toc-backref" href="#id3">Learning Python and ObsPy</a><a class="headerlink" href="#learning-python-and-obspy" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">pyasdf</span></code> is written in <a class="reference external" href="http://www.python.org">Python</a> and utilizes the
data structures of <a class="reference external" href="http://obspy.org">ObsPy</a> to allow the construction of
modern and efficient workflows. Python is an easy to learn and powerful
interactive programming language with an exhaustive scientific ecosystem. The
following resources are useful if you are starting out with Python and ObsPy:</p>
<ul class="simple">
<li><a class="reference external" href="http://learnpythonthehardway.org/book/">Good, general Python tutorial</a></li>
<li><a class="reference external" href="http://www.nature.com/news/interactive-notebooks-sharing-the-code-1.16261">IPython Notebook in Nature</a></li>
<li><a class="reference external" href="https://scipy-lectures.github.io/">Introduction to the scientific Python ecosystem</a></li>
<li><a class="reference external" href="http://docs.obspy.org/master">The ObsPy Documentation</a></li>
<li><a class="reference external" href="http://docs.obspy.org/master/tutorial/index.html">The ObsPy Tutorial</a></li>
</ul>
</div>
<div class="section" id="using-pyasdf">
<h3><a class="toc-backref" href="#id4">Using pyasdf</a><a class="headerlink" href="#using-pyasdf" title="Permalink to this headline">¶</a></h3>
<p>This section will teach you the basics of creating and working with ASDF
files with <cite>pyasdf</cite>. For more detailed information, please see the
<a class="reference internal" href="api.html"><em>API</em></a> documentation or have a look at the <a class="reference internal" href="examples.html"><em>Examples</em></a> section that
demonstrates more complex workflows.</p>
<div class="admonition-notes-on-using-mpi admonition">
<p class="first admonition-title">Notes on using MPI</p>
<p><code class="docutils literal"><span class="pre">pyasdf</span></code> will behave slightly different depending on whether it is being
called with MPI or not. If called with MPI, the underlying HDF5 files
will be opened with MPI I/O and fully parallel I/O will be utilized for
the processing functions. Keep the scripts reasonably short if using MPI
or place appropriate barriers.</p>
<p>The module will detect if it has been called with MPI if <code class="docutils literal"><span class="pre">mpi4py</span></code> can
be imported and the size of the communicator is greater than one. Thus
calling it with <code class="docutils literal"><span class="pre">mpirun/mpiexec</span></code> with only one core will not be
recognized as being called with MPI.</p>
<p class="last">Due to a limitation of Python you should always delete all references to
the <a class="reference internal" href="asdf_data_set.html#pyasdf.asdf_data_set.ASDFDataSet" title="pyasdf.asdf_data_set.ASDFDataSet"><code class="xref py py-class docutils literal"><span class="pre">ASDFDataSet</span></code></a> objects at the end.
Otherwise the program will potentially not finish when called with MPI.</p>
</div>
<div class="section" id="creating-an-asdf-data-set">
<h4><a class="toc-backref" href="#id5">Creating an ASDF data set</a><a class="headerlink" href="#creating-an-asdf-data-set" title="Permalink to this headline">¶</a></h4>
<p>The first step is always to import <code class="docutils literal"><span class="pre">pyasdf</span></code> and create a
<a class="reference internal" href="asdf_data_set.html#pyasdf.asdf_data_set.ASDFDataSet" title="pyasdf.asdf_data_set.ASDFDataSet"><code class="xref py py-class docutils literal"><span class="pre">ASDFDataSet</span></code></a> object. If the file does not
exists, it will be created, otherwise the existing one will be opened.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyasdf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span> <span class="o">=</span> <span class="n">pyasdf</span><span class="o">.</span><span class="n">ASDFDataSet</span><span class="p">(</span><span class="s">&quot;new_file.h5&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s">&quot;gzip-3&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Compression will help to reduce the size of files without affecting the
quality as all offered compression options are lossless. Only new data will
be compressed and compression will be disable for files created with
parallel I/O as these two features are not compatible. See the documentation
of the  <a class="reference internal" href="asdf_data_set.html#pyasdf.asdf_data_set.ASDFDataSet" title="pyasdf.asdf_data_set.ASDFDataSet"><code class="xref py py-class docutils literal"><span class="pre">ASDFDataSet</span></code></a> object for more details.</p>
<p>At any point you can get an overview of the contents by printing the object</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="go">ASDF file [format version: 0.0.1b]: &#39;new_file.h5&#39; (7.7 KB)</span>
<span class="go">Contains 0 event(s)</span>
<span class="go">Contains waveform data from 0 station(s).</span>
</pre></div>
</div>
<p><strong>Adding Information about an Earthquake:</strong></p>
<p>ASDF can optionally store events and associate waveforms with a given event.
To add an event with <code class="docutils literal"><span class="pre">pyasdf</span></code> use the
<a class="reference internal" href="asdf_data_set.html#pyasdf.asdf_data_set.ASDFDataSet.add_quakeml" title="pyasdf.asdf_data_set.ASDFDataSet.add_quakeml"><code class="xref py py-meth docutils literal"><span class="pre">add_quakeml()</span></code></a> method. Be aware that
all operations will directly write to the file without an explicit
<em>save/write</em> step. This enables <code class="docutils literal"><span class="pre">pyasdf</span></code> to deal with arbitrarily big data
sets.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span><span class="o">.</span><span class="n">add_quakeml</span><span class="p">(</span><span class="s">&quot;/path/to/quake.xml&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="go">ASDF file [format version: 0.0.1b]: &#39;new_file.h5&#39; (14.7 KB)</span>
<span class="go">Contains 1 event(s)</span>
<span class="go">Contains waveform data from 0 station(s).</span>
</pre></div>
</div>
<p>The event can later be accessed again by using the <code class="docutils literal"><span class="pre">event</span></code> attribute.
Please be careful that this might contain multiple events and not only one.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">event</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Adding Waveforms:</strong></p>
<p>The next step is to add waveform data. In this example we will add all SAC
files in one folder with the help of the
<a class="reference internal" href="asdf_data_set.html#pyasdf.asdf_data_set.ASDFDataSet.add_waveforms" title="pyasdf.asdf_data_set.ASDFDataSet.add_waveforms"><code class="xref py py-meth docutils literal"><span class="pre">add_waveforms()</span></code></a> method.
Printing the progress is unnecessary but useful when dealing with large
amounts of data. There are a couple of subtleties to keep in mind here:</p>
<ul class="simple">
<li>The data will be compressed with the compression settings given during the
initialization of the data set object.</li>
<li>It is possible to optionally associate waveforms with a specific event.</li>
<li>You must give a tag. The tag is an additional identifier of that particular
waveform. The <code class="docutils literal"><span class="pre">&quot;raw_recording&quot;</span></code> tag is by convention only given to raw,
unprocessed data.</li>
<li>The actual type of the data will not change. This example uses SAC which
means data is in single precision floating point, MiniSEED will typically
be in single precision integer if coming from a data center. If you desire
a different data type to be stored for whatever reason you have to
manually convert it and pass the ObsPy <a class="reference external" href="http://docs.obspy.org/packages/autogen/obspy.core.stream.Stream.html#obspy.core.stream.Stream" title="(in ObsPy Documentation (0.10.2) v0.10)"><code class="xref py py-class docutils literal"><span class="pre">Stream</span></code></a>
object.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">glob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;/path/to/data/*.mseed&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_i</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Adding file </span><span class="si">%i</span><span class="s"> of </span><span class="si">%i</span><span class="s"> ...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)))</span>
<span class="gp">... </span>    <span class="n">ds</span><span class="o">.</span><span class="n">add_waveforms</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s">&quot;raw_recording&quot;</span><span class="p">,</span> <span class="n">event_id</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
<span class="go">Adding file 1 of 588 ...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="go">ASDF file [format version: 0.0.1b]: &#39;new_file.h5&#39; (169.7 MB)</span>
<span class="go">Contains 1 event(s)</span>
<span class="go">Contains waveform data from 196 station(s).</span>
</pre></div>
</div>
<p><strong>Adding Station Information:</strong></p>
<p>The last step to create a very basic ASDF file is to add station information
which is fairly straightforward.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please keep in mind that this will potentially rearrange and split the
StationXML files to fit within the structure imposed by the ASDF format.
StationXML can store any number and combination of networks, stations,
and channels whereas ASDF requires a <strong>separate StationXML file per
station</strong>. <code class="docutils literal"><span class="pre">pyasdf</span></code> will thus split up files if necessary and also
merge them with any possibly already existing StationXML files.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;/path/to/stations/*.xml&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_i</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Adding file </span><span class="si">%i</span><span class="s"> of </span><span class="si">%i</span><span class="s"> ...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)))</span>
<span class="gp">... </span>    <span class="n">ds</span><span class="o">.</span><span class="n">add_stationxml</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="go">Adding file 1 of 196 ...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="go">ASDF file [format version: 0.0.1b]: &#39;new_file.h5&#39; (188.3 MB)</span>
<span class="go">Contains 1 event(s)</span>
<span class="go">Contains waveform data from 196 station(s).</span>
</pre></div>
</div>
<p><strong>Adding Auxiliary Data:</strong></p>
<p>The ASDF format has the capability to store generic non-waveform data called
<em>auxiliary data</em>. Auxiliary data are data arrays with associcated
attributes that can represent anything; each sub-community is supposed to come
up with conventions of how to use this.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="go"># The type always should be camel case.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_type</span> <span class="o">=</span> <span class="s">&quot;RandomArrays&quot;</span>
<span class="go"># Name to identify the particular piece of data.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tag</span> <span class="o">=</span> <span class="s">&quot;example_array&quot;</span>
<span class="go"># Any additional parameters as a Python dictionary which will end up as</span>
<span class="go"># attributes of the array.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s">&quot;b&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span><span class="o">.</span><span class="n">add_auxiliary_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
<span class="gp">... </span>                      <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="go">ASDF file [format version: b&#39;0.0.1b&#39;]: &#39;new_file.h5&#39; (188.3 MB)</span>
<span class="go">Contains 1 event(s)</span>
<span class="go">Contains waveform data from 196 station(s).</span>
<span class="go">Contains 1 type(s) of auxiliary data: RandomArrays</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="acknowledgements">
<h2><a class="toc-backref" href="#id6">Acknowledgements</a><a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>We gratefully acknowledge support from the EU-FP7 725 690 <strong>VERCE</strong> project
(number 283543, <a class="reference external" href="http://www.verce.eu">www.verce.eu</a>).</p>
</div>
<div class="section" id="detailed-documentation">
<h2><a class="toc-backref" href="#id7">Detailed Documentation</a><a class="headerlink" href="#detailed-documentation" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#pyasdf-and-dependencies">pyasdf and Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#build-the-documentation">Build the Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="asdf_data_set.html">ASDF Data Set</a></li>
</ul>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014-2015, Lion Krischer.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>